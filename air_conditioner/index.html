<!doctype html>
<html lang="zh-Hant">
<head>
    <meta charset="utf-8">
    <title>冷氣節能製冷系統</title>
    <style>
        body {
            font-family: "Segoe UI", system-ui, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #74ebd5 0%, #ACB6E5 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        footer {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-size: 14px;
            color: #fff; 
            text-shadow: 0 1px 3px rgba(0,0,0,0.3); 
            letter-spacing: 1px;
        }
        .card {
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            padding: 40px;
            text-align: center;
            width: 320px;
            animation: fadeIn 1s ease;
            position: relative; 
        }

        /* 雙數據區塊容器 */
        .data-container {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            gap: 20px; /* 增加間距 */
        }
        
        /* 單一數據區塊 */
        .data-block {
            flex: 1;
            padding: 10px;
            border-right: 1px solid #eee; /* 視覺分隔線 */
        }
        /* 移除最後一個區塊的分隔線 */
        .data-block:last-child {
            border-right: none;
        }

        h1 {
            font-size: 20px; /* 縮小標題以容納兩個 */
            margin-bottom: 10px;
            color: #333;
        }

        .value {
            font-size: 48px; /* 縮小數值以容納兩個 */
            font-weight: bold;
            color: #0078d7;
            min-height: 50px; /* 確保高度一致 */
        }

        .unit {
            font-size: 20px; /* 縮小單位 */
            color: #555;
            margin-left: 5px;
        }

        #status {
            margin-top: 10px;
            font-size: 16px;
            color: #666;
        }

        button {
            margin-top: 30px;
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            background: #0078d7;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #005a9e;
            transform: scale(1.05);
        }
        
        /* === 資訊和設定按鈕樣式 (並排) === */
        .fixed-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px; /* 按鈕間距 */
        }
        .action-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            padding: 0;
            margin: 0;
            font-size: 20px;
            line-height: 40px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 10;
            transition: transform 0.3s ease;
        }
        #infoBtn {
            background: #f7b731;
        }
        #infoBtn:hover {
            background: #f48d2e;
            transform: scale(1.1);
        }
        #configBtn {
            background: #6c757d; /* 灰色 */
        }
        #configBtn:hover {
            background: #5a6268;
            transform: scale(1.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === 基礎 Modal 樣式 (適用於所有 Modal) === */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.7); 
            justify-content: center;
            align-items: center;
            animation: modalFadeIn 0.3s;
        }

        .modal-content {
            background-color: #ffffff;
            margin: auto;
            padding: 30px;
            border-radius: 12px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
            position: relative;
            animation: modalOpen 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }

        /* --- 大型 Modal 樣式 (資訊/設定) --- */
        .modal-content.large-modal {
            width: 90%;
            max-width: 550px;
            text-align: left;
        }
        .modal-content.large-modal h2 {
            color: #0078d7;
            margin-top: 0;
            border-bottom: 3px solid #0078d7; 
            padding-bottom: 10px;
            font-size: 28px;
            letter-spacing: 1px;
        }
        .info-section, .config-section {
            margin-bottom: 25px;
            padding: 15px;
            background: #f7f9fc;
            border-left: 5px solid #0078d7;
            border-radius: 6px;
        }
        .info-section h3, .config-section h3 {
            color: #333;
            font-size: 18px;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .info-section p, .config-section p {
            margin: 5px 0;
            line-height: 1.6;
            color: #555;
        }
        .close {
            color: #555;
            position: absolute;
            top: 15px;
            right: 25px;
            font-size: 32px;
            font-weight: 300;
            cursor: pointer; 
            transition: color 0.3s;
        }
        .close:hover,
        .close:focus {
            color: #e53935; 
        }

        /* --- 狀態提示 Modal 樣式 (statusModal) --- */
        .modal-content.small-modal {
            max-width: 350px; 
            text-align: center;
            padding: 25px;
        }
        #modalTitle {
            font-size: 24px;
            margin-top: 0;
            margin-bottom: 10px;
        }
        #modalMessage {
            font-size: 16px;
            color: #333;
            margin-bottom: 15px;
        }
        .status-close {
            color: #aaa !important;
            top: 10px;
            right: 15px;
            font-size: 28px;
        }
        .status-close:hover {
            color: #333 !important;
        }
        #modalCloseBtn {
            margin-top: 0px !important;
            padding: 8px 20px !important;
        }
        
        /* 設定表單額外樣式 */
        .config-section input[type="text"], 
        .config-section input[type="number"] {
            width: 80%;
            padding: 8px; 
            font-size: 16px; 
            border-radius: 4px; 
            border: 1px solid #ccc;
            box-sizing: border-box; 
            margin-top: 5px;
        }
        .config-section input[type="number"] {
            width: 100px;
            text-align: center;
        }


        @keyframes modalFadeIn {
            from { opacity: 0; transform: scale(0.7); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes modalOpen {
            from { opacity: 0; transform: scale(0.7); }
            to { opacity: 1; transform: scale(1); }
        }

    </style>
</head>
<body>
    <div class="card">
        
        <div class="data-container">
            <div class="data-block">
                <h1>溫度</h1>
                <div class="value">
                    <span id="temp">--</span><span class="unit">°C</span>
                </div>
            </div>
            
            <div class="data-block">
                <h1>電壓</h1>
                <div class="value">
                    <span id="voltage">--</span><span class="unit">V</span>
                </div>
            </div>
        </div>
        
        <p id="status">等待資料</p>
        <button id="fanBtn">手動開啟風扇</button>
    </div>
    
    <div class="fixed-buttons">
        <button id="configBtn" class="action-btn">⚙️</button>
        <button id="infoBtn" class="action-btn">i</button>
    </div>
    
    <div id="infoModal" class="modal">
        <div class="modal-content large-modal">
            <span class="close info-close">&times;</span>
            <h2>系統資訊與說明</h2>
            
            <div class="info-section">
                <h3>使用說明</h3>
                <p><strong>溫度顯示:</strong> 實時顯示室外機附近的溫度。</p>
                <p><strong>自動模式:</strong> 系統會依據溫度閥值（可在設定中更改）自動控制風扇與並聯線。</p>
                <p><strong>手動控制:</strong> 點擊「手動開啟/關閉風扇」按鈕，將強制覆蓋自動控制，方便進行手動測試或維護。</p>
                <p><strong>切換邏輯:</strong> 點擊按鈕後，會進入手動模式。若要返回自動模式，請點擊「切換回自動模式」按鈕。</p>
                <p><strong>配置教學:</strong> 正式啟用前，且確保該設備之線路無斷路，將ESP32與網頁端連接至相同區域網路，開啟網頁確認顯示狀態。</p>
                <p><strong>設定教學:</strong> 網頁需要得知ESP32之IP位置，以連接之工作，使用電腦或手機安裝Arduino IDE之軟體，開啟序列埠監視器後重啟ESP32，以讓系統顯示IP位置出來，之後把IP複製到網頁的系統設定，重整頁面後即可連接。</p>
            </div>

            <div class="info-section">
                <h3>開發團隊與版權聲明</h3>
                <p><strong>計畫名稱:</strong> 赫拉克勒斯計畫</p>
                <p><strong>開發團隊:</strong> 赫拉克勒斯計畫開發小組</p>
                <p><strong>團隊介紹:</strong> 赫拉克勒斯計畫由三個科技工作夥伴合作，致力於為客戶提供科技開發業務</p>
                <p><strong>軟硬體工程:</strong> 由以下個人性質科技工作室：Qimei Technology Studio(QTS), Pudding Coding Studio, DWEP Studio 技術提供</p>
                <p><strong>著作權:</strong> 版權所有 © 赫拉克勒斯計畫開發小組 保留一切權利</p>
                <p><strong>範圍聲明:</strong> 本條款涵蓋本程式與附加額外服務，包含但不限於：網頁伺服器、應用程式、硬體配置</p>
                <p><strong>授權:</strong> 此專案授權國立永靖高工製圖科合法之重製、傳輸、公開展示、改作、使用</p>
                <p><strong>聯絡方式:</strong> 如有疑問或專案項目出現問題，請告知相關人員</p>
            </div>

        </div>
    </div>
    
    <div id="statusModal" class="modal">
        <div class="modal-content small-modal">
            <span class="close status-close">&times;</span>
            <h3 id="modalTitle">操作結果</h3>
            <p id="modalMessage">正在等待操作結果...</p>
            <button id="modalCloseBtn">確定</button>
        </div>
    </div>
    
    <div id="configModal" class="modal">
        <div class="modal-content large-modal">
            <span class="close config-close">&times;</span>
            <h2>⚙️ 系統設定 (儲存於瀏覽器)</h2>
            
            <div class="config-section">
                <h3>ESP32 IP設置</h3>
                <p><strong>請輸入 ESP32 實際連線的 IP 位址(使用IDE開啟序列埠監視器查看初始化提供之IP):</strong></p>
                <input type="text" id="ipInput" placeholder="例如: 192.168.1.100">
                <p id="currentIPStatus" style="font-size: 14px; margin-top: 10px; color: #555;">當前連線 IP: --</p>
            </div>

            <div class="config-section">
                <h3>溫度控制閥值</h3>
                <p><strong>請輸入自動控制模式的溫度上限 (°C):</strong></p>
                <input type="number" id="tempLimitInput" step="0.5" min="20" value="30.0">
                <p id="currentTempLimitStatus" style="font-size: 14px; margin-top: 10px; color: #555;">當前設定: -- °C</p>
            </div>
            
            <button id="saveConfigBtn" style="margin-top: 20px; background: #28a745;">儲存設定到瀏覽器</button>
            <p id="configStatusMessage" style="font-size: 14px; color: #e53935; margin-top: 10px;"></p>
        </div>
    </div>
    
    <footer>
        版權所有 © 赫拉克勒斯計畫開發小組 保留一切權利
    </footer>
    
    <script src="ctrl.js"></script> 
    
    <script>
        // *** 僅保留 Modal 視窗外側點擊邏輯，所有按鈕點擊事件已移至 ctrl.js ***
        const infoModal = document.getElementById("infoModal");
        const statusModal = document.getElementById('statusModal');
        const configModal = document.getElementById('configModal'); 

        window.onclick = function(event) {
            if (event.target == infoModal) {
                infoModal.style.display = "none";
            }
            if (event.target == statusModal) {
                statusModal.style.display = "none";
            }
            if (event.target == configModal) {
                configModal.style.display = "none";
            }
        }
    </script>
</body>
</html>